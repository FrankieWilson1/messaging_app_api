<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API Documentation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .code-block {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }
        .response-code {
            color: #27ae60;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>API Endpoint Documentation</h1>
    
    <p>This page provides detailed documentation for the API endpoints. You can use this page as a reference for interacting with the API.</p>

    <hr>
    
    <h2>1. User Registration</h2>
    <h3>Endpoint Details</h3>
    <ul>
        <li><strong>URL:</strong> <code>/api/v1/register/</code></li>
        <li><strong>Method:</strong> <code>POST</code></li>
        <li><strong>Description:</strong> This endpoint allows a new user to create an account. It is publicly accessible and does not require authentication.</li>
    </ul>
    
    <h3>Request Example</h3>
    <p>To create a new user, send a <code>POST</code> request with a JSON body containing the user's details. You can use the form below to test this endpoint.</p>
    <pre><code>{
    "username": "testuser",
    "email": "testuser@example.com",
    "first_name": "Test",
    "last_name": "User",
    "password": "strongpassword123"
}</code></pre>
    <form id="register-form">
        <label for="reg-username">Username:</label><br>
        <input type="text" id="reg-username" name="username"><br>
        <label for="reg-email">Email:</label><br>
        <input type="email" id="reg-email" name="email"><br>
        <label for="reg-password">Password:</label><br>
        <input type="password" id="reg-password" name="password"><br><br>
        <button type="submit">Register User</button>
    </form>
    <h3>Response:</h3>
    <pre id="register-response"></pre>
    
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">201 Created</span> status code. The response body will contain the public details of the newly created user.</p>
    <h3>Status Code:</h3>
    <pre><code>201 Created</code></pre>
    <h3>Response Body (JSON):</h3>
    <pre><code>{
    "username": "testuser",
    "email": "testuser@example.com",
    "first_name": "Test",
    "last_name": "User"
}</code></pre>
    <h3>Error Responses</h3>
    <p>A <strong><code>400 Bad Request</code></strong> status code is returned if the request body is invalid or if a user with the provided <code>username</code> or <code>email</code> already exists. The response body will contain details about the error.</p>
    <h3>Example Error Response:</h3>
    <pre><code>{
    "username": [
        "A user with that username already exists."
    ]
}</code></pre>

    <hr>
    
    <h2>2. Token Creation</h2>
    <h3>Endpoint Details</h3>
    <ul>
        <li><strong>URL:</strong> <code>/api/v1/token/</code></li>
        <li><strong>Method:</strong> <code>POST</code></li>
        <li><strong>Description:</strong> This endpoint is used to obtain a new access and refresh token pair by providing user credentials.</li>
    </ul>
    <h3>Request Example</h3>
    <p>To get a token, send a <code>POST</code> request with a JSON body containing a valid <code>username</code> and <code>password</code>. You can use the form below to test this endpoint.</p>
    <pre><code>{
    "username": "testuser",
    "password": "strongpassword123"
}</code></pre>
    <form id="token-form">
        <label for="token-username">Username:</label><br>
        <input type="text" id="token-username" name="username"><br>
        <label for="token-password">Password:</label><br>
        <input type="password" id="token-password" name="password"><br><br>
        <button type="submit">Get Token</button>
    </form>
    <h3>Response:</h3>
    <pre id="token-response"></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">200 OK</span> status code. The response body will contain two tokens.</p>
    <pre><code>{
    "refresh": "your_refresh_token_here",
    "access": "your_access_token_here"
}</code></pre>
    <h3>Error Responses</h3>
    <p>A <strong><code>401 Unauthorized</code></strong> status code is returned if the provided credentials are not valid.</p>
    <pre><code>{
    "detail": "No active account found with the given credentials"
}</code></pre>

    <hr>
    
    <h2>3. Conversations</h2>
    <h3>3.1. Create Conversation</h3>
    <h3>Endpoint Details</h3>
    <ul>
        <li><strong>URL:</strong> <code>/api/v1/conversations/</code></li>
        <li><strong>Method:</strong> <code>POST</code></li>
        <li><strong>Description:</strong> Creates a new conversation with a list of participants. Requires a valid access token.</li>
    </ul>
    <h3>Request Example</h3>
    <p>To create a new conversation, send a <code>POST</code> request with a JSON body containing a list of participant IDs. The access token must be included in the <code>Authorization</code> header.</p>
    <h3>Headers:</h3>
    <pre><code>Authorization: Bearer &lt;your_access_token&gt;</code></pre>
    <h3>Request Body (JSON):</h3>
    <pre><code>{
    "participants": ["c1368b98-0b73-4ec5-baf5-bfa21c5c1cb5"]
}</code></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">201 Created</span> status code and the details of the newly created conversation.</p>
    <pre><code>{
    "participants": [...],
    "message_set": [],
    "conversation_id": "59adae78-adf4-4680-a425-06792a01c733",
    "created_at": "2025-09-07T12:05:27.254730Z"
}</code></pre>
    <h3>Error Responses</h3>
    <p>A <strong><code>401 Unauthorized</code></strong> status code is returned if the request lacks a valid access token.</p>

    <h3>3.2. Retrieve All Conversations</h3>
    <h3>Endpoint Details</h3>
    <ul>
        <li><strong>URL:</strong> <code>/api/v1/conversations/</code></li>
        <li><strong>Method:</strong> <code>GET</code></li>
        <li><strong>Description:</strong> Retrieves a list of all conversations the authenticated user is a part of. Requires a valid access token.</li>
    </ul>
    <h3>Request Example</h3>
    <p>To retrieve all conversations, send a <code>GET</code> request to the conversations endpoint.</p>
    <h3>Headers:</h3>
    <pre><code>Authorization: Bearer &lt;your_access_token&gt;</code></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">200 OK</span> status code and a JSON array containing all conversations.</p>
    <pre><code>[
    {
        "participants": [
            {
                "user_id": "c1368b98-0b73-4ec5-baf5-bfa21c5c1cb5",
                "first_name": "bob",
                "last_name": "doe",
                "username": "bob",
                "email": "bob@gmail.com",
                "created_at": "2025-09-07T11:48:56.520047Z",
                "phone_number": null
            },
            {
                "user_id": "9a7f34f2-9a03-4f96-b333-e9d6d5a1c1d8",
                "first_name": "alice",
                "last_name": "smith",
                "username": "alice",
                "email": "alice@gmail.com",
                "created_at": "2025-09-06T11:48:56.520047Z",
                "phone_number": null
            }
        ],
        "message_set": [],
        "conversation_id": "59adae78-adf4-4680-a425-06792a01c733",
        "created_at": "2025-09-07T12:05:27.254730Z"
    }
]</code></pre>
    <h3>Error Responses</h3>
    <p>A <strong><code>401 Unauthorized</code></strong> status code is returned if the request lacks a valid access token.</p>

    <hr>

    <h2>4. Messages</h2>
    <h3>4.1. Send Message</h3>
    <h3>Endpoint Details</h3>
    <ul>
        <li><strong>URL:</strong> <code>/api/v1/conversations/&lt;uuid:conversation_id&gt;/messages/</code></li>
        <li><strong>Method:</strong> <code>POST</code></li>
        <li><strong>Description:</strong> Sends a message to an existing conversation. Requires a valid access token.</li>
    </ul>
    <h3>Request Example</h3>
    <p>To send a message, send a <code>POST</code> request to the messages endpoint of a specific conversation. The message body is the only required field.</p>
    <h3>Headers:</h3>
    <pre><code>Authorization: Bearer &lt;your_access_token&gt;</code></pre>
    <h3>Request Body (JSON):</h3>
    <pre><code>{
    "message_body": "Hello, this is my first message!"
}</code></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">201 Created</span> status code and the details of the newly created message.</p>
    <pre><code>{
    "message_id": "d4d9f518-d03e-4c02-883a-ca415d980791",
    "sender": {
        "user_id": "c1368b98-0b73-4ec5-baf5-bfa21c5c1cb5",
        "first_name": "bob",
        "last_name": "doe",
        "username": "bob",
        "role": "guest",
        "email": "bob@gmail.com",
        "created_at": "2025-09-07T12:11:58.222519Z",
        "phone_number": null
    },
    "sent_at": "2025-09-07T12:11:58.222519Z",
    "message_body": "Hello, this is my first message in this conversation!"
}</code></pre>
    <h3>Error Responses</h3>
    <p>A <strong><code>401 Unauthorized</code></strong> status code is returned if the request lacks a valid access token.</p>
    
    <h3>4.2. Retrieve Messages</h3>
    <h3>Endpoint Details</h3>
    <ul>
        <li><strong>URL:</strong> <code>/api/v1/conversations/&lt;uuid:conversation_id&gt;/messages/</code></li>
        <li><strong>Method:</strong> <code>GET</code></li>
        <li><strong>Description:</strong> Retrieves all messages within a specific conversation. Requires a valid access token.</li>
    </ul>
    <h3>Request Example</h3>
    <p>To retrieve messages, send a <code>GET</code> request to the messages endpoint of a specific conversation.</p>
    <h3>Headers:</h3>
    <pre><code>Authorization: Bearer &lt;your_access_token&gt;</code></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">200 OK</span> status code and a JSON array containing all messages in the conversation.</p>
    <pre><code>[
    {
        "message_id": "d4d9f518-d03e-4c02-883a-ca415d980791",
        "sender": {
            "user_id": "c1368b98-0b73-4ec5-baf5-bfa21c5c1cb5",
            "first_name": "bob",
            "last_name": "doe",
            "username": "bob",
            "role": "guest",
            "email": "bob@gmail.com",
            "created_at": "2025-09-07T12:11:58.222519Z",
            "phone_number": null
        },
        "sent_at": "2025-09-07T12:11:58.222519Z",
        "message_body": "Hello, this is my first message in this conversation!"
    },
    {
        "message_id": "9a7f34f2-9a03-4f96-b333-e9d6d5a1c1d8",
        "sender": {
            "user_id": "c1368b98-0b73-4ec5-baf5-bfa21c5c1cb5",
            "first_name": "bob",
            "last_name": "doe",
            "username": "bob",
            "role": "guest",
            "email": "bob@gmail.com",
            "created_at": "2025-09-07T12:15:30.123456Z",
            "phone_number": null
        },
        "sent_at": "2025-09-07T12:15:30.123456Z",
        "message_body": "Hello, this is my second message in this conversation!"
    }
]</code></pre>
    <h3>Error Responses</h3>
    <p>A <strong><code>401 Unauthorized</code></strong> status code is returned if the request lacks a valid access token.</p>
    <p>A <strong><code>404 Not Found</code></strong> status code is returned if the specified conversation ID does not exist.</p>

    <hr>
    
    <h2>5. User Profile</h2>
    <h3>Endpoint Details</h3>
    <ul>
        <li><strong>URL:</strong> <code>/api/v1/users/me/</code></li>
        <li><strong>Method:</strong> <code>GET</code>, <code>PATCH</code>, <code>DELETE</code></li>
        <li><strong>Description:</strong> This endpoint allows the authenticated user to retrieve, update, and delete their own profile.</li>
    </ul>
    
    <h3>5.1. Retrieve Profile (GET)</h3>
    <h3>Request Example</h3>
    <p>To retrieve your profile, send a <code>GET</code> request to the endpoint. No request body is required.</p>
    <h3>Headers:</h3>
    <pre><code>Authorization: Bearer &lt;your_access_token&gt;</code></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">200 OK</span> status code and the user's profile details.</p>
    <pre><code>{
    "user_id": "c1368b98-0b73-4ec5-baf5-bfa21c5c1cb5",
    "first_name": "bob",
    "last_name": "doe",
    "username": "bob",
    "role": "guest",
    "email": "bob@gmail.com",
    "created_at": "2025-09-07T11:48:56.520047Z",
    "phone_number": null
}</code></pre>
    
    <h3>5.2. Update Profile (PATCH)</h3>
    <h3>Request Example</h3>
    <p>To update your profile, send a <code>PATCH</code> request with a JSON body containing the fields you wish to update.</p>
    <h3>Headers:</h3>
    <pre><code>Authorization: Bearer &lt;your_access_token&gt;</code></pre>
    <h3>Request Body (JSON):</h3>
    <pre><code>{
    "username": "new_username",
    "first_name": "New First Name"
}</code></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">200 OK</span> status code and the updated user object in the response body.</p>
    <pre><code>{
    "user_id": "c1368b98-0b73-4ec5-baf5-bfa21c5c1cb5",
    "first_name": "New First Name",
    "last_name": "doe",
    "username": "new_username",
    "role": "guest",
    "email": "bob@gmail.com",
    "created_at": "2025-09-07T11:48:56.520047Z",
    "phone_number": null
}</code></pre>

    <h3>5.3. Delete Profile (DELETE)</h3>
    <h3>Request Example</h3>
    <p>To delete your profile, send a <code>DELETE</code> request to the endpoint. This action is irreversible.</p>
    <h3>Headers:</h3>
    <pre><code>Authorization: Bearer &lt;your_access_token&gt;</code></pre>
    <h3>Successful Response</h3>
    <p>A successful request will return a <span class="response-code">204 No Content</span> status code and an empty response body.</p>
    <pre><code>204 No Content</code></pre>

    <h3>Error Responses for User Profile Endpoints</h3>
    <p>A <strong><code>401 Unauthorized</code></strong> status code is returned for all methods if the request lacks a valid access token.</p>

    <script>
        document.getElementById('register-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const username = document.getElementById('reg-username').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const firstName = document.getElementById('reg-first-name').value;
            const lastName = document.getElementById('reg-last-name').value;

            try {
                const response = await fetch('http://127.0.0.1:8000/api/v1/register/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username,
                        email,
                        first_name: firstName,
                        last_name: lastName,
                        password
                    })
                });
                const data = await response.json();
                document.getElementById('register-response').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('register-response').textContent = "Failed to connect to the API.";
            }
        });

        document.getElementById('token-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const username = document.getElementById('token-username').value;
            const password = document.getElementById('token-password').value;

            try {
                const response = await fetch('http://127.0.0.1:8000/api/v1/token/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await response.json();
                document.getElementById('token-response').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('token-response').textContent = "Failed to connect to the API.";
            }
        });
    </script>
</body>
</html>